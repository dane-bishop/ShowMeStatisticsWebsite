{% extends 'base.html' %}
{% from "components/player_card.html" import player_card %}

{% block title %}Home • ShowMeStatistics{% endblock %}

{% block banner %}

<!-- News Banner -->
<section class="headline-banner">
  <a href="{{ url_for('routes.news') }}" class="news-btn">News</a>
  <div class="headlines">
    {% for h in headlines %}
      <div class="headline-item">
        <span class="headline-date">{{ h.date }}</span>
        <span class="headline-text">{{ h.headline }}</span>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}

{% block content %}




  



<!-- Recent and Upcoming Events -->
<section class="layout">
  <div class="calendar-card">
    
    <div class="calendar-header">Recent Events</div>
    <div class="calendar-grid">
      {% for e in past_events %}
        <a class="event-card" href="{{ url_for('routes.game_detail', game_id=e.id) }}" >

          <div class="event-date-row">
            <span class="event-sport">
              {{ e.sport_name }}
            </span>


            <span class="event-score
              {% if e.score_for is not none and e.score_against is not none %}
                {% if e.score_for > e.score_against %}
                  score-win
                {% elif e.score_for < e.score_against %}
                  score-loss
                {% endif %}
              {% endif %}
            ">
              {{ e.score_for }}
            </span>


          </div>  
          <div class="event-date-row">
            <span class="event-sport-away">{{ e.opponent_name }}</span>



            <span class="event-score
              {% if e.score_for is not none and e.score_against is not none %}
                {% if e.score_against > e.score_for %}
                  score-win
                {% elif e.score_against < e.score_for %}
                  score-loss
                {% endif %}
              {% endif %}
            ">
              {{ e.score_against }}
            </span>
          
          </div>  
  
          <div class="event-meta">{{ e.game_date }} • {{ e.location }} • {{ e.result }}</div>
          
        </a>
      {% endfor %}
    </div>

    

    <div class="calendar-header">Upcoming Events</div>
    <div class="calendar-grid">
      {% for e in upcoming_events %}
        <a class="event-card" href="{{ url_for('routes.game_detail', game_id=e.id) }}" >

          <div class="event-date">{{ e.sport_name }}</div>  
          <div class="event-title">VS {{ e.opponent_name }}</div>
          <div class="event-meta">{{ e.game_date }} • {{ e.location }}</div>
          
        </a>
      {% endfor %}
    </div>
    <div class="calendar">
    <div class="calendar-calendar">
  <iframe id="gcal-frame" src="https://calendar.google.com/calendar/embed?height=600&wkst=1&ctz=America%2FChicago&showPrint=0&src=MWlkcXZsNGhvMGJvZHZta2g1MGpldGE0cjlhOWI3MHVAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=MGZoOTdlMW5odWt0dGZ1MTQ3am1qcWU5bGEyNDZrNjdAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=NHZpdm5lYWdhYmUxczd0bG1vYmIyNmRyNDYxOWhlaThAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=Y2FsdjEycDRpbG1sb3RsZ2ZwaTk2Yjg1bmlycXNuNGtAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=MWJrbGdmajNwZzE4cnR2cGxpc29pOWcyNmcyYTh0cTFAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=b2VmdmUwY285Y3MxYmYybjVrOW1tbXU2bXAxNGZqY2RAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=ajk2MTFoYXFnaDFsYWlmcHB1NHNlNTg4cHRqMTEwM2xAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=YzU1c2psdTJ2MjYydHFiZ2N2dDJnZGxrMjU3cjV2bDZAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=dDljcjhycmp1ODM4ZnBmNzY4dHA1NHU5MThqM3B0MGpAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=MTd2cGNsY2U5ZXUxODFuYnM3NjhqZTk3dmhzZXRiYWRAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=cW1ndjhobWs5OGtzZzBlM2VoY2NiN2huaG50MzY1Y2RAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=a3IzYjBrYmUybmdjZWFpdWpoaGFpYXE1MHZ2YnB1aDJAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=dmptYnVxNDQ0YmlpdnYydDdjcXV2bTBtOHVwbGtwdGpAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=Ymo5cWRpb2QwanJ1M2NkZnIycHFpaWlwNWtmYnFzY2NAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=bDA3NTgwaW82YWlvazh0NmNpcDIxdHZqdm1lYmxnZWRAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&src=bnMyb2VlaHNscmlya3Jib2tidHV2am51cnFtZGNuNGdAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&color=%23e67c73&color=%23ad1457&color=%23ef6c00&color=%23f6bf26&color=%23d81b60&color=%23f6bf26&color=%23d50000&color=%239e69af&color=%233f51b5&color=%234285f4&color=%234285f4&color=%233f51b5&color=%239e69af&color=%239e69af&color=%23d81b60&color=%23e4c441" style="border:solid 1px #777" width="800" height="600" frameborder="0" scrolling="no"></iframe>
    </div>
  </div>
</div>






<!-- Filter Sports Section -->
<div class="filters">
  <div class="filters-header">Filter Sports</div>

<div class="filter-buttons">
  <button type="button" class="select-all-btn">Select All</button>
  <button type="button" class="unselect-all-btn">Unselect All</button>
</div>

<div id="calendar-toggles">
  <label><input type="checkbox" id="deselect" value="ns2oeehslrirkrbokbtuvjnurqmdcn4g@import.calendar.google.com"></label>
  <div><b>Men's Sports</b><br>
  <label><input type="checkbox" unchecked value="bj9qdiod0jru3cdfr2pqiiip5kfbqscc@import.calendar.google.com">Baseball</label><br>
  <label><input type="checkbox" unchecked value="j9611haqgh1laifppu4se588ptj1103l@import.calendar.google.com">Basketball</label><br>
  <label><input type="checkbox" unchecked value="0fh97e1nhukttfu147jmjqe9la246k67@import.calendar.google.com">Football </label><br>
  <label><input type="checkbox" unchecked value="c55sjlu2v262tqbgcvt2gdlk257r5vl6@import.calendar.google.com">Golf</label><br>
  <label><input type="checkbox" unchecked value="vjmbuq444biivv2t7cquvm0m8uplkptj@import.calendar.google.com">Wrestling</label><br>
    </div><div><b>Women's Sports</b><br>
  <label><input type="checkbox" unchecked value="qmgv8hmk98ksg0e3ehccb7hnhnt365cd@import.calendar.google.com">Basketball</label><br>
  <label><input type="checkbox" unchecked value="kr3b0kbe2ngceaiujhhaiaq50vvbpuh2@import.calendar.google.com">Golf</label><br>
  <label><input type="checkbox" unchecked value="l07580io6aiok8t6cip21tvjvmeblged@import.calendar.google.com">Gymnastics</label><br>
  <label><input type="checkbox" unchecked value="4vivneagabe1s7tlmobb26dr4619hei8@import.calendar.google.com">Soccer</label><br>
  <label><input type="checkbox" unchecked value="calv12p4ilmlotlgfpi96b85nirqsn4k@import.calendar.google.com">Softball </label><br>
  <label><input type="checkbox" unchecked value="17vpclce9eu181nbs768je97vhsetbad@import.calendar.google.com">Tennis</label><br>
  <label><input type="checkbox" unchecked value="oefve0co9cs1bf2n5k9mmmu6mp14fjcd@import.calendar.google.com">Volleyball</label><br>
    </div><div><b>Coeval Sports</b><br>
  <label><input type="checkbox" unchecked value="1idqvl4ho0bodvmkh50jeta4r9a9b70u@import.calendar.google.com">Cross Country </label><br>
  <label><input type="checkbox" unchecked value="1bklgfj3pg18rtvplisoi9g26g2a8tq1@import.calendar.google.com">Track and Field</label><br>
  <label><input type="checkbox" unchecked value="t9cr8rrju838fpf768tp54u918j3pt0j@import.calendar.google.com">Swimming and Diving</label><br></div>
</div>

</div>


<!-- Add favorite players here -->
{% set fps = fav_players | default([]) %}


<!-- Favorite Players as its own section with similar design -->
<section class="panel">
  <div class="panel-header">Saved Players</div>

  {% set fps = fav_players | default([]) %}
  {% if fps %}
    <div class="cards three">
      {% for p in fps %}
        {{ player_card(p) }}
      {% endfor %}
    </div>
  {% else %}
    <div class="card-meta">No favorite players yet. Find a player and tap the ♥ icon.</div>
  {% endif %}
</section>


<script>

const iframe = document.getElementById('gcal-frame');
const checkboxes = document.querySelectorAll('#calendar-toggles input[type="checkbox"]');
const selectAllBtn = document.querySelector('.select-all-btn');
const unselectAllBtn = document.querySelector('.unselect-all-btn');

const allBox = document.getElementById('deselect');   // “All” calendar

function updateCalendar() {
  const base = 'https://calendar.google.com/calendar/embed?ctz=America/Chicago';
  const selected = Array.from(checkboxes)
    .filter(cb => cb.checked)
    .map(cb => '&src=' + encodeURIComponent(cb.value))
    .join('');
  iframe.src = base + selected;
}


// all
selectAllBtn.addEventListener('click', () => {
  // Uncheck all first
  checkboxes.forEach(cb => cb.checked = false);
  // Check all visible checkboxes except the hidden 'all' box
  checkboxes.forEach(cb => {
    if (cb.id !== 'deselect') {
      cb.checked = true;
    }
  });
  // Uncheck the hidden 'all' box
  allBox.checked = false;
  updateCalendar();
});

// none
unselectAllBtn.addEventListener('click', () => {
  checkboxes.forEach(cb => cb.checked = false);
  updateCalendar();
});

// On page load, check all checkboxes except the hidden 'all' box
checkboxes.forEach(cb => {
  if (cb.id !== 'deselect') {
    cb.checked = true;
  }
});

checkboxes.forEach(cb => cb.addEventListener('change', updateCalendar));

updateCalendar();
</script>
</section>
<!-- hide 'all' checkbox -->
<style>
  #deselect {
    display: none;
  }
</style>

{% endblock %}
