{% extends 'base.html' %}
{% from "components/player_card.html" import player_card %}

{% block title %}Home • ShowMeStatistics{% endblock %}

{% block banner %}

{# =============== NEWS BANNER =============== #}
<section class="headline-banner">
  <a href="{{ url_for('routes.news') }}" class="news-btn">News</a>
  <div class="headlines">
    {% for h in headlines %}
      <div class="headline-item">
        <span class="headline-date">{{ h.date }}</span>
        <span class="headline-text">{{ h.headline }}</span>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}






{% block content %}

<section class="layout">

  

  {# ================ RECENT EVENTS =============== #}
  <div class="calendar-card">
    

    <div class="calendar-header">
      Recent Events
    </div>

    <div class="calendar-grid">
      {% for e in past_events %}


        <a class="event-card" href="{{ url_for('routes.game_detail', game_id=e.id) }}" >

          <div class="event-date-row">

            <span class="event-sport">
              {{ e.sport_name }}
            </span>

            <span class="event-score
              {% if e.score_for is not none and e.score_against is not none %}
                {% if e.score_for > e.score_against %}
                  score-win
                {% elif e.score_for < e.score_against %}
                  score-loss
                {% endif %}
              {% endif %}
            ">
              {{ e.score_for }}
            </span>

          </div>  


          <div class="event-date-row">

            <div class="event-opponent">
              <img
                  class="recent-team-logo"
                  src="{{ url_for('static', filename='assets/logos/' ~ e.opponent_name ~ '.png') }}"
                  alt="{{ g.home_school_name }} logo"
                  loading="lazy"
                  onerror="this.style.visibility='hidden';"
              >
              <span class="event-sport-away">{{ e.opponent_name }}</span>
            </div>

            

            <span class="event-score
              {% if e.score_for is not none and e.score_against is not none %}
                {% if e.score_against > e.score_for %}
                  score-win
                {% elif e.score_against < e.score_for %}
                  score-loss
                {% endif %}
              {% endif %}
            ">
              {{ e.score_against }}
            </span>
          
          </div>  
  
          <div class="event-meta">{{ e.game_date }} • {{ e.location }} • {{ e.result }}</div>
          
        </a>
      {% endfor %}
    </div>

    



    {# ================ UPCOMING EVENTS =============== #}
    <div class="calendar-header">
      Upcoming Events
    </div>

    <div class="calendar-grid">
      {% for e in upcoming_events %}
        <a class="event-card" href="{{ url_for('routes.game_detail', game_id=e.id) }}" >

          <div class="event-date">{{ e.sport_name }} VS</div>  

          <div class="event-title">
            <img
                  class="recent-team-logo"
                  src="{{ url_for('static', filename='assets/logos/' ~ e.opponent_name ~ '.png') }}"
                  alt="{{ g.home_school_name }} logo"
                  loading="lazy"
                  onerror="this.style.visibility='hidden';"
              >
            
              <span class="event-sport-away">{{ e.opponent_name }}</span>
          </div>
          
          <div class="event-meta">{{ e.game_date }} • {{ e.location }}</div>
          
        </a>
      {% endfor %}
    </div>



    {# =============== CALENDAR =============== #}
    <div class="calendar">

      
      <div class="calendar-month-nav">
        <a
          class="cal-nav-btn"
          href="{{ url_for('routes.home', month=calendar_prev) }}"
        >
          ‹ Prev
        </a>

        <div class="cal-month-label">
          {{ calendar_label }}
        </div>

        <a
          class="cal-nav-btn"
          href="{{ url_for('routes.home', month=calendar_next) }}"
        >
          Next ›
        </a>
      </div>

      
      <!-- Month grid -->
      <div class="month-grid">
        {# Day-of-week header #}
        <div class="dow">Sun</div>
        <div class="dow">Mon</div>
        <div class="dow">Tue</div>
        <div class="dow">Wed</div>
        <div class="dow">Thu</div>
        <div class="dow">Fri</div>
        <div class="dow">Sat</div>

        {# Weeks + days #}
        {% for week in calendar_weeks %}
          {% for day in week %}
            {% set key = day.isoformat() %}
            {% set in_current_month = (day.month == calendar_month and day.year == calendar_year) %}

            <div class="month-day {% if not in_current_month %}other-month{% endif %}">
              <div class="day-number">
                {{ day.day }}
              </div>

              {% if games_by_date.get(key) %}
                <div class="day-games">
                  {% for g in games_by_date[key] %}
                    <a
                      href="{{ url_for('routes.game_detail', game_id=g.id) }}"
                      class="day-game-link"
                    >
                      <span class="day-game-sport">{{ g.sport_name }}</span>
                      <span class="day-game-opponent">vs {{ g.opponent_name }}</span>

                      {% if g.result %}
                        <span class="day-game-result {{ 'win' if g.result == 'W' else 'loss' }}">
                          {{ g.result }}
                        </span>
                      {% endif %}
                    </a>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          {% endfor %}
        {% endfor %}
      </div>
    </div>
    
    
    
  
  </div>










{# =============== FILTER SPORTS SECTION =============== #}
<form id="sport-filter-form" class="filters" method="get">

  <input type="hidden" name="month" value="{{ calendar_current }}">

  <div class="filters-header">Filter Sports</div>

  <div class="filter-buttons">
    <button type="button" class="select-all-btn">Select All</button>
    <button type="button" class="unselect-all-btn">Unselect All</button>
  </div>

  <div id="calendar-toggles">

    <div>
      <b>Men's Sports</b><br>

      <label>
        <input
          type="checkbox"
          name="sports"
          value="Baseball"
          {% if 'Baseball' in selected_sports %}checked{% endif %}
        >
        Baseball
      </label><br>

      <label>
        <input
          type="checkbox"
          name="sports"
          value="Men's Basketball"
          {% if "Men's Basketball" in selected_sports %}checked{% endif %}
        >
        Basketball
      </label><br>

      <label>
        <input
          type="checkbox"
          name="sports"
          value="Football"
          {% if 'Football' in selected_sports %}checked{% endif %}
        >
        Football 
      </label><br>


    </div>

    <div>
      <b>Women's Sports</b><br>

      <label>
        <input
          type="checkbox"
          name="sports"
          value="Women's Basketball"
          {% if "Women's Basketball" in selected_sports %}checked{% endif %}
        >
        Basketball
      </label><br>

      <label>
        <input
          type="checkbox"
          name="sports"
          value="Women's Volleyball"
          {% if "Women's Volleyball" in selected_sports %}checked{% endif %}
        >
        Volleyball
      </label><br>

 
    </div>

    <div>
      <b>Other Sports</b><br>


    </div>

  </div>
</form>







  {# =============== FAVORITE PLAYERS =============== #}
  
  {% set fps = fav_players | default([]) %}
  <section class="panel">

    <div class="panel-header">Saved Players</div>

    {% set fps = fav_players | default([]) %}
    {% if fps %}

      <div class="cards three">
        {% for p in fps %}
          {{ player_card(p) }}
        {% endfor %}
      </div>
      
    {% else %}
      <div class="card-meta">No favorite players yet. Find a player and tap the ♥ icon.</div>
    {% endif %}
  </section>






</section>




</section>





<!-- hide 'all' checkbox -->
<style>
  #deselect {
    display: none;
  }
</style>

<script>
  const filterForm = document.getElementById('sport-filter-form');
  if (filterForm) {
    const sportCheckboxes = filterForm.querySelectorAll('input[type="checkbox"][name="sports"]');
    const selectAllBtn = filterForm.querySelector('.select-all-btn');
    const unselectAllBtn = filterForm.querySelector('.unselect-all-btn');

    // Auto-submit when a box is toggled
    sportCheckboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        filterForm.submit();
      });
    });

    // Select all
    if (selectAllBtn) {
      selectAllBtn.addEventListener('click', () => {
        sportCheckboxes.forEach(cb => cb.checked = true);
        filterForm.submit();
      });
    }

    // Unselect all
    if (unselectAllBtn) {
      unselectAllBtn.addEventListener('click', () => {
        sportCheckboxes.forEach(cb => cb.checked = false);
        filterForm.submit();
      });
    }
  }
</script>


{% endblock %}


