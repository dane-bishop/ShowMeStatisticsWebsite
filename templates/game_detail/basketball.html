{% extends 'game_detail/base.html' %}

{% block tabs_extra %}
  <a class="tab" href="#player-stats">Player Stats</a>

{% endblock %}

{% block boxscore_sections %}

  <!-- Basketball Stats -->
  <div id="player-stats" class="calendar-card">
    <div class="calendar-header">Game Stats</div>
    {% if player_basketball_stats %}
      <div class="table-wrap">
        <table class="table sortable" id="basketball-stats-table">
          <thead>
            <tr>
              <th data-sort="num">#</th>
              <th data-sort="text">Player</th>
              <th data-sort="num">MIN</th>
              <th data-sort="madeatt">FG</th>
              <th data-sort="num">FG%</th>
              <th data-sort="madeatt">3PT</th>
              <th data-sort="num">3PT%</th>
              <th data-sort="madeatt">FT</th>
              <th data-sort="num">FT%</th>
              <th data-sort="num">OR</th>
              <th data-sort="num">DR</th>
              <th data-sort="num">TOT</th>
              <th data-sort="num">PF</th>
              <th data-sort="num">AST</th>
              <th data-sort="num">TO</th>
              <th data-sort="num">BLK</th>
              <th data-sort="num">STL</th>
              <th data-sort="num">PTS</th>
            </tr>
          </thead>
          <tbody>
            {% for r in player_basketball_stats %}
              <tr>
                <td>{{ r.jersey or '' }}</td>
                <td class="player-name">{{ r.full_name }}</td>
                <td>{{ r.minutes or 0 }}</td>
                <td>{{ r.fg_made or 0 }} - {{ r.fg_att or 0}}</td>
                <td>{{ r.fg_pct or 0 }}</td>
                <td>{{ r.three_made or 0 }} - {{r.three_att or 0}}</td>
                <td>{{ r.three_pct or 0 }}</td>
                <td>{{ r.ft_made or 0 }} - {{r.ft_att or 0}}</td>
                <td>{{ r.ft_pct or 0 }}</td>
                <td>{{ r.off_r or 0 }}</td>
                <td>{{ r.dr or 0 }}</td>
                <td>{{ r.tr or 0 }}</td>
                <td>{{ r.pf or 0 }}</td>
                <td>{{ r.ast or 0 }}</td>
                <td>{{ r.turnovers or 0 }}</td>
                <td>{{ r.blk or 0 }}</td>
                <td>{{ r.stl or 0 }}</td>
                <td>{{ r.pts or 0 }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="empty-state">No game stats.</div>
    {% endif %}
  </div>




  <!-- Sorting Script -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const table = document.querySelector("#basketball-stats-table");
      if (!table) return;
    
      const tbody = table.querySelector("tbody");
      const headers = table.querySelectorAll("thead th");
    
      headers.forEach((th, index) => {
        const sortType = th.dataset.sort;
        if (!sortType) return; // skip non-sortable
    
        th.style.cursor = "pointer";
    
        th.addEventListener("click", () => {
          const currentOrder = th.dataset.order === "asc" ? "desc" : "asc";
          // reset others
          headers.forEach(h => { if (h !== th) h.dataset.order = ""; });
          th.dataset.order = currentOrder;
    
          const rows = Array.from(tbody.querySelectorAll("tr"));
    
          rows.sort((rowA, rowB) => {
            const cellA = rowA.children[index].innerText.trim();
            const cellB = rowB.children[index].innerText.trim();
    
            const valA = getCellValue(cellA, sortType);
            const valB = getCellValue(cellB, sortType);
    
            if (valA < valB) return currentOrder === "asc" ? -1 : 1;
            if (valA > valB) return currentOrder === "asc" ? 1 : -1;
            return 0;
          });
    
          rows.forEach(r => tbody.appendChild(r));
        });
      });
    
      function getCellValue(text, sortType) {
        if (sortType === "num") {
          const n = parseFloat(text.replace(/[^0-9.\-]/g, ""));
          return isNaN(n) ? 0 : n;
        }
    
        if (sortType === "madeatt") {
          // "5 - 10" â†’ 5
          const left = text.split("-")[0].trim();
          const n = parseFloat(left);
          return isNaN(n) ? 0 : n;
        }
    
        // text sort: case-insensitive
        return text.toLowerCase();
      }
    });
    </script>
    
  

{% endblock %}






