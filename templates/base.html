<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}ShowMeStatistics{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
    <header class="topbar">
        <div class="topbar-left">
            <button class="menu-dropdown" id="menuDropdownBtn">☰</button>
            <div class="dropdown" id="menuDropdown">
                <a href="{{ url_for('routes.home') }}">Home</a>
                <a href="{{ url_for('routes.news') }}">News</a>
                <a href="{{ url_for('routes.teams') }}">Teams</a>
                <a href="{{ url_for('routes.players') }}">Players</a>
                <a href="{{ url_for('routes.scores') }}">Scores</a>
            </div>
            <a href="/" class="brand">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" onerror="this.style.display='none'" />
                <span>ShowMeStatistics</span>
            </a>
        </div>
        <form class="search" action="{{ url_for('routes.search') }}" method="get">
            <input type="text" name="q" placeholder="Search teams, players, scores..." value="{{ request.args.get('q','') }}" />
            <button type="submit">Search</button>
        </form>
        <div class="topbar-right">
            {% if current_user.is_authenticated %}
              <span class="user-chip">Hi, {{ current_user.display_name or current_user.email }}</span>
              <a class="profile-btn" href="{{ url_for('routes.profile') }}">Profile</a>
              <form method="post" action="{{ url_for('auth.logout_submit') }}" style="display:inline">
                <button class="linklike" type="submit">Sign out</button>
              </form>
            {% else %}
              <a class="profile-btn" href="{{ url_for('auth.login_form') }}">Sign in</a>
              <a class="profile-btn" href="{{ url_for('auth.register_form') }}">Register</a>
            {% endif %}
          </div>
          
    </header>

    {% block banner %}{% endblock %}

    <main class="container">
        {% block content %}{% endblock %}
    </main>

    <script>
    // simple dropdown toggle
    const btn = document.getElementById('menuDropdownBtn');
    const menu = document.getElementById('menuDropdown');
    if (btn && menu) {
      btn.addEventListener('click', () => {
        menu.classList.toggle('open');
      });
      document.addEventListener('click', (e) => {
        if (!btn.contains(e.target) && !menu.contains(e.target)) {
          menu.classList.remove('open');
        }
      });
    }
    </script>

<script>
  document.addEventListener('click', async (e) => {
    const btn = e.target.closest('.favorite-btn');
    if (!btn || btn.classList.contains('hint')) return;
  
    e.preventDefault();
    const type = btn.dataset.type;
    const id = parseInt(btn.dataset.id, 10);
    if (!type || !id) return;
  
    try {
      const res = await fetch('{{ url_for("favorites.toggle_favorite") }}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type, id })
      });
      if (!res.ok) throw new Error('Request failed');
  
      const data = await res.json(); // { ok: true, favorited: bool }
      const on = !!data.favorited;
      btn.setAttribute('aria-pressed', on ? 'true' : 'false');
      btn.textContent = on ? '♥' : '♡';
    } catch (err) {
      console.error(err);
      // optional: show a toast/flash
    }
  });
  </script>
  
    
</body>
</html>


